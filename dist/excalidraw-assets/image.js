(self.webpackChunkExcalidraw=self.webpackChunkExcalidraw||[]).push([[9],{8527:function(e,t,r){"use strict";r.r(t),r.d(t,{decodePngMetadata:function(){return A},decodeSvgMetadata:function(){return I},encodePngMetadata:function(){return E},encodeSvgMetadata:function(){return L},getTEXtChunk:function(){return m}});var n=r(7945),a=r.n(n),c=r(5374),u=r.n(c),o=r(2983),s=r.n(o),i=r(1194),f=r(3434),p=r.n(f),d=r(2744),l=function(e){return new Promise((function(t,r){var n="string"==typeof e?new Blob([(new TextEncoder).encode(e)]):new Blob([e]),a=new FileReader;a.onload=function(e){if(!e.target||"string"!=typeof e.target.result)return r(new Error("couldn't convert to byte string"));t(e.target.result)},a.readAsBinaryString(n)}))},x=function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,a=e.length;n<a;n++)r[n]=e.charCodeAt(n);return t},w=function(e){return new TextDecoder("utf-8").decode(x(e))},v=function(){var e=u()(a().mark((function e(t){var r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>1&&void 0!==r[1]&&r[1])){e.next=5;break}e.t0=btoa(t),e.next=10;break;case 5:return e.t1=btoa,e.next=8,l(t);case 8:e.t2=e.sent,e.t0=(0,e.t1)(e.t2);case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=u()(a().mark((function e(t){var r,n=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]&&n[1],e.abrupt("return",r?atob(t):w(atob(t)));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=u()(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.text,!1===t.compress){e.next=11;break}return e.prev=2,e.next=5,l((0,d.deflate)(r));case 5:n=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("encode: cannot deflate",e.t0);case 11:if(e.t1=!!n,e.t2=n,e.t2){e.next=17;break}return e.next=16,l(r);case 16:e.t2=e.sent;case 17:return e.t3=e.t2,e.abrupt("return",{version:"1",encoding:"bstring",compressed:e.t1,encoded:e.t3});case 19:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=u()(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.encoding,e.next="bstring"===e.t0?3:12;break;case 3:if(!t.compressed){e.next=7;break}e.t1=t.encoded,e.next=10;break;case 7:return e.next=9,w(t.encoded);case 9:e.t1=e.sent;case 10:return r=e.t1,e.abrupt("break",13);case 12:throw new Error('decode: unknown encoding "'.concat(t.encoding,'"'));case 13:if(!t.compressed){e.next=15;break}return e.abrupt("return",(0,d.inflate)(new Uint8Array(x(r)),{to:"string"}));case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=r(8288),g=function(e){return"arrayBuffer"in e?e.arrayBuffer():new Promise((function(t,r){var n=new FileReader;n.onload=function(e){var n;if(null===(n=e.target)||void 0===n||!n.result)return r(new Error("couldn't convert blob to ArrayBuffer"));t(e.target.result)},n.readAsArrayBuffer(e)}))},m=function(){var e=u()(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s(),e.t1=Uint8Array,e.next=4,g(t);case 4:if(e.t2=e.sent,e.t3=new e.t1(e.t2),r=(0,e.t0)(e.t3),!(n=r.find((function(e){return"tEXt"===e.name})))){e.next=10;break}return e.abrupt("return",i.decode(n.data));case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=u()(a().mark((function e(t){var r,n,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.blob,n=t.metadata,e.t0=s(),e.t1=Uint8Array,e.next=5,g(r);case 5:return e.t2=e.sent,e.t3=new e.t1(e.t2),c=(0,e.t0)(e.t3),e.t4=i,e.t5=k.LO.excalidraw,e.t6=JSON,e.next=13,h({text:n,compress:!0});case 13:return e.t7=e.sent,e.t8=e.t6.stringify.call(e.t6,e.t7),u=e.t4.encode.call(e.t4,e.t5,e.t8),c.splice(-1,0,u),e.abrupt("return",new Blob([p()(c)],{type:"image/png"}));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=u()(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t);case 2:if((null==(r=e.sent)?void 0:r.keyword)!==k.LO.excalidraw){e.next=19;break}if(e.prev=4,"encoded"in(n=JSON.parse(r.text))){e.next=10;break}if(!("type"in n)||"excalidraw"!==n.type){e.next=9;break}return e.abrupt("return",r.text);case 9:throw new Error("FAILED");case 10:return e.next=12,y(n);case 12:return e.abrupt("return",e.sent);case 15:throw e.prev=15,e.t0=e.catch(4),console.error(e.t0),new Error("FAILED");case 19:throw new Error("INVALID");case 20:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=u()(a().mark((function e(t){var r,n,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.text,e.t0=v,e.t1=JSON,e.next=5,h({text:r});case 5:return e.t2=e.sent,e.t3=e.t1.stringify.call(e.t1,e.t2),e.next=9,(0,e.t0)(e.t3,!0);case 9:return n=e.sent,c="",c+="\x3c!-- payload-type:".concat(k.LO.excalidraw," --\x3e"),c+="\x3c!-- payload-version:2 --\x3e",c+="\x3c!-- payload-start --\x3e",c+=n,c+="\x3c!-- payload-end --\x3e",e.abrupt("return",c);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=u()(a().mark((function e(t){var r,n,c,u,o,s,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.svg).includes("payload-type:".concat(k.LO.excalidraw))){e.next=26;break}if(n=r.match(/<!-- payload-start -->(.+?)<!-- payload-end -->/)){e.next=5;break}throw new Error("INVALID");case 5:return c=r.match(/<!-- payload-version:(\d+) -->/),u=(null==c?void 0:c[1])||"1",o="1"!==u,e.prev=8,e.next=11,b(n[1],o);case 11:if(s=e.sent,"encoded"in(i=JSON.parse(s))){e.next=17;break}if(!("type"in i)||"excalidraw"!==i.type){e.next=16;break}return e.abrupt("return",s);case 16:throw new Error("FAILED");case 17:return e.next=19,y(i);case 19:return e.abrupt("return",e.sent);case 22:throw e.prev=22,e.t0=e.catch(8),console.error(e.t0),new Error("FAILED");case 26:throw new Error("INVALID");case 27:case"end":return e.stop()}}),e,null,[[8,22]])})));return function(t){return e.apply(this,arguments)}}()}}]);